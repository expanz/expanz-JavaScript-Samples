<html>
<head>

<link href="css/common.css?1308766139" media="screen" rel="stylesheet" type="text/css" />

<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js'></script>
<script type='text/javascript' src='../../Expanz-JavaScript-SDK/js/knockout-1.2.1.js' ></script>
<script type='text/javascript' src='../../Expanz-JavaScript-SDK/js/jquery.cookies.2.2.0.js'></script>
<script type='text/javascript' src='../../Expanz-JavaScript-SDK/js/expanz.js?987245745' ></script>

<script type='text/javascript'>

   $(document).ready( function(){

      $('#menu .menuitem').click(   function(){
            $(this).find('ul').toggle( );
      });
      $('#menu .menuitem ul').hide();

   });

   $(document).ExpanzLoad( function(){

      $('tbody > tr').click( function(){
         $(this).siblings().each( function(){ $(this).removeClass('selected'); } );
         $(this).addClass('selected');
      });

   });

   var customerListSelector = function closure(){
      var selector = $('#customerList > table > tbody > .selected').attr('id').replace(/.*_/g, '');
      customerListSelector = function result( reset ){
         if( reset !== false )
            selector = $('#customerList > table > tbody > .selected').attr('id').replace(/.*_/g, '');
         return selector;
      };
   }

   function createActivityForCustomer( fields ){
      $.get( "./activity.sales.customer.properties.html", function(html){
            $('div#properties-container').html( '<div id="container" class="Activity" name="Sales.Customer" initialKey="' + customerListSelector(false) +'" ></div>' );
            $('div#properties-container > #container').html( html );
            DynamicLoadActivity();
            openPropertiesBox();
      });
   }

   function openPropertiesBox(){
      $('#properties-container').show('slow');
   }

   function closePropertiesBox(){
      $('#properties-container').hide('slow');
      $('div#properties-container').html("");
      DynamicLoadActivity();
   }

</script>

</head>
<body>

<div id='menu'></div>

<div id='container' class='Activity' name='Sales.Customer' >

   <div class='GridView' id='customerList' popluateMethod="ListMe"></div>

   <div class='submit'>
      <button  id='properties'
               action-name='1'
               data-bind='click: MenuAction'
               context-selector='customerListSelector'
               onSuccess='createActivityForCustomer'>
                  Properties
               </button>
   </div>

</div>

<div id='properties-container'></div>

</body>
</html>
